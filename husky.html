<!DOCTYPE html>
<html>
    <head>
        <title>Husky UGV 3D Model</title>
        <meta name="author" content="SymMotion" />
        <style>
            body {
                overflow: hidden;
                margin: 0px;
            }

            #progressBar {
                width: 500px;
                height: 24px;
                position: absolute;
                left: 50%;
                top: 10px;
                margin-left: -250px;
            }
        </style>
        <!-- Import maps polyfill -->
        <!-- Remove this when import maps will be widely supported -->
        <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>
        <script type="importmap">
            {
                "imports": {
                    "three": "https://unpkg.com/three@0.143.0/build/three.module.js",
                    "three/examples/jsm/controls/OrbitControls": "https://unpkg.com/three@0.143.0/examples/jsm/controls/OrbitControls.js",
                    "three/examples/jsm/loaders/STLLoader": "https://unpkg.com/three@0.143.0/examples/jsm/loaders/STLLoader.js",
                    "three/examples/jsm/libs/stats.module": "https://unpkg.com/three@0.143.0/examples/jsm/libs/stats.module.js"
                }
            }
        </script>
    </head>

    <body>
        <progress value="0" max="100" id="progressBar"></progress>
        <script type="module">
            import * as THREE from 'three'
            import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls'
            import { STLLoader } from 'three/examples/jsm/loaders/STLLoader'
            import Stats from 'three/examples/jsm/libs/stats.module'
            const scene = new THREE.Scene()
            var light = new THREE.DirectionalLight()
            light.position.set(2.5, 7.5, 15)
            scene.add(light)
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000)
            camera.position.z = 4
            const renderer = new THREE.WebGLRenderer()
            renderer.outputEncoding = THREE.sRGBEncoding
            renderer.setSize(window.innerWidth, window.innerHeight)
            document.body.appendChild(renderer.domElement)
            const controls = new OrbitControls(camera, renderer.domElement)
            controls.enableDamping = true
            const envTexture = new THREE.CubeTextureLoader().load([
                'https://corsproxy.io/?https://github.com/SymMotion/showcase_web/raw/main/assets/px_25.jpg',
                'https://corsproxy.io/?https://github.com/SymMotion/showcase_web/raw/main/assets/nx_25.jpg',
                'https://corsproxy.io/?https://github.com/SymMotion/showcase_web/raw/main/assets/py_25.jpg',
                'https://corsproxy.io/?https://github.com/SymMotion/showcase_web/raw/main/assets/ny_25.jpg',
                'https://corsproxy.io/?https://github.com/SymMotion/showcase_web/raw/main/assets/pz_25.jpg',
                'https://corsproxy.io/?https://github.com/SymMotion/showcase_web/raw/main/assets/nz_25.jpg',
            ])
            envTexture.mapping = THREE.CubeReflectionMapping
            const material = new THREE.MeshPhysicalMaterial({
                color: 0xb2ffc8,
                envMap: envTexture,
                metalness: 0.1,
                roughness: 0.1,
                transparent: true,
                transmission: 1.0,
                side: THREE.DoubleSide,
                clearcoat: 1.0,
                clearcoatRoughness: 0.25,
            })
            const loader = new STLLoader()
            let mesh
            loader.load(
                'https://corsproxy.io/?https://github.com/SymMotion/showcase_web/raw/main/assets/husky.stl',
                function (geometry) {
                    mesh = new THREE.Mesh(geometry, material)
                    scene.add(mesh)
                    progressBar.style.display = 'none'
                },
                (xhr) => {
                    if (xhr.lengthComputable) {
                        var percentComplete = (xhr.loaded / xhr.total) * 100
                        progressBar.value = percentComplete
                        progressBar.style.display = 'block'
                    }
                },
                (error) => {
                    console.log(error)
                }
            )
            window.addEventListener('resize', onWindowResize, false)
            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight
                camera.updateProjectionMatrix()
                renderer.setSize(window.innerWidth, window.innerHeight)
                render()
            }
            const stats = Stats()
            document.body.appendChild(stats.dom)
            var animate = function () {
                requestAnimationFrame(animate)
                controls.update()
                render()
                stats.update()
            }
            function render() {
                renderer.render(scene, camera)
            }
            animate()
        </script>
    </body>
</html>